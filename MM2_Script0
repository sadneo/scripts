--[[
ChangeLogs 1.2
    Changed layout to be more organized
Changelogs 1.1
    Fixed Esp
Changelogs 1.0
]]



-- Variables

local player = game.Players.LocalPlayer
local mouse = player:GetMouse()

isKnivesEnabled = false
isTrapsEnabled = false
isStrafingEnabled = false
MEspEnabled = false
SEspEnabled = false
GEspEnabled = false

isThrowing = false
isTrapping = false
isStrafing = false

SongID = nil
TrapTarget = nil
RunningSpeed = 24

-- Functions

local CreateESPPart = function(BodyPart,color)
    local ESPPartparent = BodyPart
    local Box = Instance.new("BoxHandleAdornment")
    Box.Size = BodyPart.Size + Vector3.new(0.1, 0.1, 0.1)
    Box.Name = "ESPPart"
    Box.Adornee = ESPPartparent
    Box.Color3 = color
    Box.AlwaysOnTop = true
    Box.ZIndex = 5
    Box.Transparency = 0.5
    Box.Parent = BodyPart
end
-- Get players, get body parts, if v:IsA("Part") then CreateEspPart

-- UI

local library = loadstring(game:HttpGet("https://pastebin.com/raw/SKZjdjdj"))();
local Section1 = library:CreateSection("Active");
local Section2 = library:CreateSection("Passive");

Section1:Toggle("Invisibility", function(callback)
    game:GetService("ReplicatedStorage").Remotes.Gameplay.Stealth:FireServer(callback)
end)
Section1:Toggle("Sprint Trail", function(callback)
    game.Players.LocalPlayer.Character.SpeedTrail.Toggle(callback)
    -- local Event = game:GetService("Workspace").NeoIsSad.SpeedTrail.Toggle if that doesn't work
end)
Section1:Box("Song ID", function(callback)
    SongID = callback
end)
Section1:Button("Play Song", function()
    print("Play Song Button Pressed")
    game:GetService("ReplicatedStorage").PlaySong:FireServer("https://www.roblox.com/asset/?id=".. SongID)
end)
Section1:Button("God Mode", function()
    player.Character.Humanoid.Name = "1"
    local l = player.Character["1"]:Clone()
    l.Parent = player.Character
    l.Name = "Humanoid"; wait(0.1)
    player.Character["1"]:Destroy()
    workspace.CurrentCamera.CameraSubject = player.Character.Humanoid
    player.Character.Animate.Disabled = true; wait(0.1)
    player.Character.Animate.Disabled = false
    l.BreakJointsOnDeath = false
end)
Section1:Button("Grab Gun", function()
    local currentX = game.Players.LocalPlayer.Character.HumanoidRootPart.CFrame.X
    local currentY = game.Players.LocalPlayer.Character.HumanoidRootPart.CFrame.Y
    local currentZ = game.Players.LocalPlayer.Character.HumanoidRootPart.CFrame.Z

    if workspace:FindFirstChild("GunDrop") ~= nil then
        game.Players.LocalPlayer.Character.HumanoidRootPart.CFrame = workspace:FindFirstChild("GunDrop").CFrame
        wait(.25)
        game.Players.LocalPlayer.Character.HumanoidRootPart.CFrame = CFrame.new(currentX, currentY, currentZ)
    end
end)
Section1:Button("Fake Gun", function()
    local A_1 = true
    local Event = game:GetService("ReplicatedStorage").Remotes.Gameplay.FakeGun
    Event:FireServer(A_1)
end)
Section1:Button("Emotes", function(callback)
    local emote = require(game:GetService("ReplicatedStorage").Modules.EmoteModule).GeneratePage
    local target = game.Players.LocalPlayer.PlayerGui.MainGUI.Game:FindFirstChild("Emotes")
    local emotelist = {"headless","zombie","zen","ninja","floss","dab"}
    emote(emotelist,target,'Emotes')
end)

Section2:Box("Running Speed", function(callback)
    RunningSpeed = callback
end)
Section2:Toggle("Noclip Enabled", function(callback)
    isStrafingEnabled = callback
end)
Section2:Toggle("Knives Enabled", function(callback)
    isKnivesEnabled = callback
end)
Section2:Toggle("Traps Enabled", function(callback)
    isTrapsEnabled = callback
end)
Section2:Toggle("Murderer Esp", function(callback)
    MEspEnabled = callback
    print(callback)
end)
Section2:Toggle("Sherrif Esp", function(callback)
    SEspEnabled = callback
    print(callback)
end)
Section2:Toggle("View Gun", function(callback)
    GEspEnabled = callback
    print(callback)
end)

--[[
Section2:Box("Target", function(callback)
    TrapTarget = callback
end)
Section2:Button("Looptrap Target", function()
    while wait(1) do
        local hrp = game.Players:FindFirstChild(TrapTarget).Character.HumanoidRootPart
        local hrppos = hrp.CFrame
        local Event = game:GetService("ReplicatedStorage").TrapSystem.PlaceTrap:FireServer(hrppos)
    end
end)
Section2:Button("Looptrap All", function(callback)
    for i,v in pairs(game.Players:GetPlayers()) do
        repeat
            wait(1)
            local hrp = game.Players:FindFirstChild(v).Character.HumanoidRootPart
            local hrppos = hrp.CFrame
            local Event = game:GetService("ReplicatedStorage").TrapSystem.PlaceTrap:FireServer(hrppos)
        until hrp == nil
    end
    repeat
        wait()
        if not char or not char:IsDescendantOf(game:GetService("Workspace")) then
            char = plr.Character or plr.CharacterAdded:Wait()
        end
        hum = char:FindFirstChild("Humanoid")
    until hum ~= nil


    while wait(1) do
        local hrp = game.Players:FindFirstChild(TrapTarget).Character.HumanoidRootPart
        local hrppos = hrp.CFrame
        local Event = game:GetService("ReplicatedStorage").TrapSystem.PlaceTrap:FireServer(hrppos)
    end
end)
]]

library:Ready();

-- Scripts

game:GetService("RunService").Stepped:Connect(function()
    if isThrowing == true and isKnivesEnabled == true then
        local hrp = game.Players.LocalPlayer.Character.HumanoidRootPart
        local mousepos = mouse.Hit; local mousex = mousepos.X; local mousey = mousepos.Y; local mousez = mousepos.Z
        local hmdpos = hrp.Position; local hmdx = hmdpos.X; local hmdy = hmdpos.Y; local hmdz = hmdpos.Z
        local A_1 = CFrame.new(mousex, mousey, mousez)
        local A_2 = Vector3.new(hmdx, hmdy, hmdz)
        game.Players.LocalPlayer.Character.Knife.Throw:FireServer(A_1, A_2)
    elseif isTrapping == true and isTrapsEnabled == true then
        local mousepos = mouse.Hit; local mousex = mousepos.X; local mousey = mousepos.Y; local mousez = mousepos.Z
        local A_1 = CFrame.new(mousex, mousey, mousez)
        local Event = game:GetService("ReplicatedStorage").TrapSystem.PlaceTrap
        Event:InvokeServer(A_1)
    elseif isStrafing == true and isStrafingEnabled == true then
        game.Players.LocalPlayer.Character.Humanoid:ChangeState(11)
    end
end)

game:GetService("RunService").RenderStepped:Connect(function()
    if MEspEnabled == true then
        for i,Player in pairs(game.Players:GetPlayers()) do
            print(Player)
            for j, Backpack in pairs(Player:GetChildren()) do
                print(Backpack)
                if Backpack.Name == "Backpack" then
                    if Backpack:FindFirstChild("Knife") then
                        local ESPBODY = Backpack.Parent.Character.HumanoidRootPart
                        if ESPBODY:FindFirstChild("ESPPart") == nil then
                            CreateESPPart(ESPBODY, Color3.fromRGB(255,0,0))
                        end
                    end
                end
            end
        end
    elseif MEspEnabled == false then
        for i,Player in pairs(game.Players:GetPlayers()) do
            for j, Backpack in pairs(Player:GetChildren()) do
                if Backpack.Name == "Backpack" then
                    if Backpack:FindFirstChild("Knife") then
                        local ESPBODY = Backpack.Parent.Character.HumanoidRootPart
                        if ESPBODY:FindFirstChild("ESPPart") ~= nil then
                            ESPBODY:FindFirstChild("ESPPart"):Destroy()
                        end
                    end
                end
            end
        end
    end
end)
game:GetService("RunService").RenderStepped:Connect(function()
    if SEspEnabled == true then
        for i,Player in pairs(game.Players:GetPlayers()) do
            for j, Backpack in pairs(Player:GetChildren()) do
                if Backpack.Name == "Backpack" then
                    if Backpack:FindFirstChild("Gun") then
                        local ESPBODY = Backpack.Parent.Character.HumanoidRootPart
                        if ESPBODY:FindFirstChild("ESPPart") == nil then
                            ESPBODY:FindFirstChild("ESPPart"):Destroy()
                        end
                    end
                end
            end
        end
    elseif SEspEnabled == false then
        for i,Player in pairs(game.Players:GetPlayers()) do
            for j, Backpack in pairs(Player:GetChildren()) do
                if Backpack.Name == "Backpack" then
                    if Backpack:FindFirstChild("Gun") then
                        local ESPBODY = Backpack.Parent.Character.HumanoidRootPart
                        if ESPBODY:FindFirstChild("ESPPart") ~= nil then
                            ESPBODY:FindFirstChild("ESPPart"):Destroy()
                        end
                    end
                end
            end
        end
    end
end)
game:GetService("RunService").RenderStepped:Connect(function()
    if GEspEnabled == true then
        for i,gun in pairs(game.Workspace:GetChildren()) do
            if gun.Name == "GunDrop" then
                if gun:FindFirstChild("ESPPart") == nil then
                    CreateESPPart(gun, Color3.fromRGB(0,255,0))
                end
            end
        end
    elseif GEspEnabled == false then
        for i,gun in pairs(game.Workspace:GetChildren()) do
            if gun.Name == "GunDrop" then
                if gun:FindFirstChild("ESPPart") ~= nil then
                    gun:FindFirstChild("ESPPart"):Destroy()
                end
            end
        end
    end
end)

game:GetService("UserInputService").InputBegan:Connect(function(input, gameProcessedEvent)
	if gameProcessedEvent then return end
	if input.KeyCode == Enum.KeyCode.R then
		isThrowing = true
	elseif input.KeyCode == Enum.KeyCode.T then
        isTrapping = true
    elseif input.KeyCode == Enum.KeyCode.B then
        isStrafing = not isStrafing
    elseif input.KeyCode == Enum.KeyCode.LeftControl then
        game.Players.LocalPlayer.Character.Humanoid.WalkSpeed = RunningSpeed
    end
end)

game:GetService("UserInputService").InputEnded:Connect(function(input, gameProcessedEvent)
	if gameProcessedEvent then return end
	if input.KeyCode == Enum.KeyCode.R then
		isThrowing = false
	elseif input.KeyCode == Enum.KeyCode.T then
		isTrapping = false
    elseif input.KeyCode == Enum.KeyCode.LeftControl then
        game.Players.LocalPlayer.Character.Humanoid.WalkSpeed = 16
    end
end)
