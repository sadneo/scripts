--[[
Changelogs 1.0
    made thing
ChangeLogs 1.2
    Changed layout to be more organized
Changelogs 1.1
    Fixed Esp
ChangeLogs 2.0
    Made new section, reformatted code a bit
Changelogs 2.1
    Fixed Sherrif Esp
    Deleted trap section since it wasn't done
]]

-- Services
local Players = game:GetService("Players")
local ReplicatedStorage = game:GetService("ReplicatedStorage")
local RunService = game:GetService("RunService")
local UserInputService = game:GetService("UserInputService")

-- Constants
local player = Players.LocalPlayer
local mouse = player:GetMouse()

-- States
local targetName
local isTrappingAll = false
local isTrappingTarget = false

local isKnivesEnabled = false
local isTrapsEnabled = false
local isStrafingEnabled = false
local MEspEnabled = false
local SEspEnabled = false
local GEspEnabled = false

local isThrowing = false
local isTrapping = false
local isStrafing = false

local RunningSpeed = 24

-- Functions

local CreateESPPart = function(BodyPart,color)
    local ESPPartparent = BodyPart
    local Box = Instance.new("BoxHandleAdornment")
    Box.Size = BodyPart.Size + Vector3.new(0.1, 0.1, 0.1)
    Box.Name = "ESPPart"
    Box.Adornee = ESPPartparent
    Box.Color3 = color
    Box.AlwaysOnTop = true
    Box.ZIndex = 5
    Box.Transparency = 0.5
    Box.Parent = BodyPart
end

-- UI

local library = loadstring(game:HttpGet("https://pastebin.com/raw/SKZjdjdj"))();
local Section1 = library:CreateSection("Active");
local Section2 = library:CreateSection("Passive");
--local Section3 = library:CreateSection("Other")

Section1:Toggle("Invisibility", function(callback)
    ReplicatedStorage.Remotes.Gameplay.Stealth:FireServer(callback)
end)
Section1:Toggle("Sprint Trail", function(callback)
    Players.LocalPlayer.Character.SpeedTrail.Toggle(callback)
    -- local Event = workspace.NeoIsSad.SpeedTrail.Toggle if that doesn't work
end)
Section1:Button("God Mode", function()
    player.Character.Humanoid.Name = "1"
    local l = player.Character["1"]:Clone()
    l.Parent = player.Character
    l.Name = "Humanoid"; wait(0.1)
    player.Character["1"]:Destroy()
    workspace.CurrentCamera.CameraSubject = player.Character.Humanoid
    player.Character.Animate.Disabled = true; wait(0.1)
    player.Character.Animate.Disabled = false
    l.BreakJointsOnDeath = false
end)
Section1:Button("Grab Gun", function()
    local currentX = Players.LocalPlayer.Character.HumanoidRootPart.CFrame.X
    local currentY = Players.LocalPlayer.Character.HumanoidRootPart.CFrame.Y
    local currentZ = Players.LocalPlayer.Character.HumanoidRootPart.CFrame.Z

    if workspace:FindFirstChild("GunDrop") ~= nil then
        Players.LocalPlayer.Character.HumanoidRootPart.CFrame = workspace:FindFirstChild("GunDrop").CFrame
        wait(.25)
        Players.LocalPlayer.Character.HumanoidRootPart.CFrame = CFrame.new(currentX, currentY, currentZ)
    end
end)
Section1:Button("Fake Gun", function()
    local A_1 = true
    local Event = ReplicatedStorage.Remotes.Gameplay.FakeGun
    Event:FireServer(A_1)
end)
Section1:Button("Emotes", function(callback)
    local emote = require(ReplicatedStorage.Modules.EmoteModule).GeneratePage
    local target = Players.LocalPlayer.PlayerGui.MainGUI.Game:FindFirstChild("Emotes")
    local emotelist = {"headless","zombie","zen","ninja","floss","dab"}
    emote(emotelist,target,'Emotes')
end)

Section2:Toggle("Noclip Enabled", function(callback)
    isStrafingEnabled = callback
end)
Section2:Toggle("Knives Enabled", function(callback)
    isKnivesEnabled = callback
end)
Section2:Toggle("Traps Enabled", function(callback)
    isTrapsEnabled = callback
end)
Section2:Toggle("Murderer Esp", function(callback)
    MEspEnabled = callback
end)
Section2:Toggle("Sherrif Esp", function(callback)
    SEspEnabled = callback
end)
Section2:Toggle("View Gun", function(callback)
    GEspEnabled = callback
end)
Section2:Box("Running Speed", function(callback)
    RunningSpeed = callback
end)
--[[
Section3:Box("Target", function(callback)
    targetName = callback
end)
Section3:Button("Trap Target", function()
	local targetPlayer = Players:FindFirstChild(targetName)
	local hrp = targetPlayer.Character.HumanoidRootPart.CFrame
	ReplicatedStorage.TrapSystem.PlaceTrap:FireServer(hrppos)
end)
Section3:Toggle("LoopTrap Target", function(callback)
	isTrappingTarget = callback
end)

Section3:Button("Trap All", function()
    for i,v in pairs(Players:GetPlayers()) do
		local hrp = v.Character.HumanoidRootPart.CFrame
		ReplicatedStorage.TrapSystem.PlaceTrap:FireServer(hrppos)
	end
end)
Section3:Toggle("LoopTrap All", function(callback)
	isTrappingAll = callback
end)
]]
library:Ready();

-- Scripts

RunService.Stepped:Connect(function()
    if isThrowing == true and isKnivesEnabled == true then
        local hrp = Players.LocalPlayer.Character.HumanoidRootPart
        local mousepos = mouse.Hit; local mousex = mousepos.X; local mousey = mousepos.Y; local mousez = mousepos.Z
        local hmdpos = hrp.Position; local hmdx = hmdpos.X; local hmdy = hmdpos.Y; local hmdz = hmdpos.Z
        local A_1 = CFrame.new(mousex, mousey, mousez)
        local A_2 = Vector3.new(hmdx, hmdy, hmdz)
        Players.LocalPlayer.Character.Knife.Throw:FireServer(A_1, A_2)
end
end)

RunService.Stepped:Connect(function()
    if isTrapping == true and isTrapsEnabled == true then
        local mousepos = mouse.Hit; local mousex = mousepos.X; local mousey = mousepos.Y; local mousez = mousepos.Z
        local A_1 = CFrame.new(mousex, mousey, mousez)
        local Event = ReplicatedStorage.TrapSystem.PlaceTrap
        Event:InvokeServer(A_1)
    end
end)

RunService.Stepped:Connect(function()
    if isStrafing == true and isStrafingEnabled == true then
        Players.LocalPlayer.Character.Humanoid:ChangeState(11)
    end
end)

RunService.RenderStepped:Connect(function()
    if MEspEnabled == true then
        for i,Player in pairs(Players:GetPlayers()) do
            for j, Backpack in pairs(Player:GetChildren()) do
                if Backpack.Name == "Backpack" then
                    if Backpack:FindFirstChild("Knife") then
                        local ESPBODY = Backpack.Parent.Character.HumanoidRootPart
                        if ESPBODY:FindFirstChild("ESPPart") == nil then
                            CreateESPPart(ESPBODY, Color3.fromRGB(255,0,0))
                        end
                    end
                end
            end
        end
    elseif MEspEnabled == false then
        for i,Player in pairs(Players:GetPlayers()) do
            for j, Backpack in pairs(Player:GetChildren()) do
                if Backpack.Name == "Backpack" then
                    if Backpack:FindFirstChild("Knife") then
                        local ESPBODY = Backpack.Parent.Character.HumanoidRootPart
                        if ESPBODY:FindFirstChild("ESPPart") ~= nil then
                            ESPBODY:FindFirstChild("ESPPart"):Destroy()
                        end
                    end
                end
            end
        end
    end
end)
RunService.RenderStepped:Connect(function()
    if SEspEnabled == true then
        for i,Player in pairs(Players:GetPlayers()) do
            for j, Backpack in pairs(Player:GetChildren()) do
                if Backpack.Name == "Backpack" then
                    if Backpack:FindFirstChild("Gun") then
                        local ESPBODY = Backpack.Parent.Character.HumanoidRootPart
                        if ESPBODY:FindFirstChild("ESPPart") == nil then
                            CreateESPPart(ESPBODY, Color3.fromRGB(0,0,255))
                        end
                    end
                end
            end
        end
    elseif SEspEnabled == false then
        for i,Player in pairs(Players:GetPlayers()) do
            for j, Backpack in pairs(Player:GetChildren()) do
                if Backpack.Name == "Backpack" then
                    if Backpack:FindFirstChild("Gun") then
                        local ESPBODY = Backpack.Parent.Character.HumanoidRootPart
                        if ESPBODY:FindFirstChild("ESPPart") ~= nil then
                            ESPBODY:FindFirstChild("ESPPart"):Destroy()
                        end
                    end
                end
            end
        end
    end
end)
RunService.RenderStepped:Connect(function()
    if GEspEnabled == true then
        for i,gun in pairs(workspace:GetChildren()) do
            if gun.Name == "GunDrop" then
                if gun:FindFirstChild("ESPPart") == nil then
                    CreateESPPart(gun, Color3.fromRGB(0,255,0))
                end
            end
        end
    elseif GEspEnabled == false then
        for i,gun in pairs(workspace:GetChildren()) do
            if gun.Name == "GunDrop" then
                if gun:FindFirstChild("ESPPart") ~= nil then
                    gun:FindFirstChild("ESPPart"):Destroy()
                end
            end
        end
    end
end)

UserInputService.InputBegan:Connect(function(input, gameProcessedEvent)
	if gameProcessedEvent then return end
	if input.KeyCode == Enum.KeyCode.R then
		isThrowing = true
	elseif input.KeyCode == Enum.KeyCode.T then
        isTrapping = true
    elseif input.KeyCode == Enum.KeyCode.B then
        isStrafing = not isStrafing
    elseif input.KeyCode == Enum.KeyCode.LeftControl then
        Players.LocalPlayer.Character.Humanoid.WalkSpeed = RunningSpeed
    end
end)

UserInputService.InputEnded:Connect(function(input, gameProcessedEvent)
	if gameProcessedEvent then return end
	if input.KeyCode == Enum.KeyCode.R then
		isThrowing = false
	elseif input.KeyCode == Enum.KeyCode.T then
		isTrapping = false
    elseif input.KeyCode == Enum.KeyCode.LeftControl then
        Players.LocalPlayer.Character.Humanoid.WalkSpeed = 16
    end
end)
